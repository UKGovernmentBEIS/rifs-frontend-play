@(opportunity: Opportunity, sectionNumber: Int)

@proposition = {
    <div class="header-proposition">
        <div class="content">
            <nav id="proposition-menu" class="header__menu" role="navigation">
                <span class="header__menu__proposition-name">Research and Innovation Funding Service</span>

                <ul id="proposition-links" class="header__menu__proposition-links">
                    <li><a id="logOutNavHref" href="" data-journey-click="primary-navigation:Click:Sign out">
                        Sign out</a></li>
                </ul>
            </nav>
        </div>
    </div>
}

@sectionLink(title: String, sectionNum: Int) = @{
    if(sectionNum == sectionNumber) s"$sectionNum. $title"
    else {
        val link = controllers.routes.OpportunityController.showOpportunity(opportunity.id, Some(sectionNum))
        s"""$sectionNum. <a href="$link">$title</a>"""
    }
}

@titleCols() = @{
    val titles = opportunity.description.sortBy(_.sectionNumber).map(s => (s.title, s.sectionNumber))
    val midpoint: Int = Math.round(titles.length / 2.0).toInt
    val (leftCols, b) = titles.splitAt(midpoint)
    val rightCols = b.map(Some(_)) :+ None
    leftCols.zip(rightCols)
}

@section = @{
    opportunity.description.find(_.sectionNumber == sectionNumber)
}

@main(s"Opportunity ${opportunity.id.id}", insideHeader = proposition) {
    <div>
        <h1>@opportunity.title</h1>

        <header>
            <table>
                <tbody>
                @titleCols.map { case (col1, col2) =>
                <tr>
                    <td>@Html(sectionLink(col1._1, col1._2))</td>
                    <td>@col2.map { t => @Html(sectionLink(t._1, t._2)) }.getOrElse("")
                </td>
                </tr>
                }
                </tbody>
            </table>
        </header>

        @if(sectionNumber == 1) {
            <div>
                <h3>Start date</h3>
                @opportunity.startDate
                <h3>Days duration</h3>
                @opportunity.duration.map(d => s"${d.duration} ${d.units}").getOrElse("Open indefinitely")
                <h3>Opportunity value</h3>
                    &pound; @opportunity.value.amount @opportunity.value.unit
            </div>
        }

        @section.map { s =>
            <article>
                <h1>@s.sectionNumber. @s.title</h1>
                @s.paragraphs.map { p =>
                    <p>@p</p>
                }
            </article>
        }
    </div>
}