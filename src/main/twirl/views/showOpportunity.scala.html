@(applicationId: ApplicationFormId, opportunity: Opportunity, sectionNumber: Int)

@sectionLink(title: String, sectionNum: Int) = {
    <span class="part-number">@sectionNum.</span>
    @if(sectionNum == sectionNumber) {
        @title
    } else {
        <a href="@controllers.routes.OpportunityController.showOpportunity(opportunity.id, Some(sectionNum))">@title</a>
    }
}

@titleCols() = @{
    val titles = opportunity.description.sortBy(_.sectionNumber).map(s => (s.title, s.sectionNumber))
    val midpoint: Int = Math.round(titles.length / 2.0).toInt
    val (leftCols, b) = titles.splitAt(midpoint)
    val rightCols = b.map(Some(_)) :+ None
    leftCols.zip(rightCols)
}

@nextSection = @{
    opportunity.description.find(_.sectionNumber == sectionNumber + 1)
}

@prevSection = @{
    opportunity.description.find(_.sectionNumber == sectionNumber - 1)
}

@currentSection = @{
    opportunity.description.find(_.sectionNumber == sectionNumber)
}

@main(s"Opportunity ${opportunity.id.id}") {
<div class="grid-row">
    <div class="column-two-thirds">

        <div class="breadcrumbs" aria-label="Return to opportunity list" role="navigation">
            <ol>
                <li><a href="@controllers.routes.OpportunityController.showOpportunities()">&lt; Return to opportunity
                    list</a></li>
            </ol>
        </div>


        <header class="page-header">
            <h1 class="heading-xlarge">@opportunity.title</h1>
        </header>

        <aside>
            <nav role="navigation" class="contain-floats page-navigation" aria-label="Navigation">
                <ol>
                    @titleCols.map { case (col1, col2) =>
                        <li>
                            @sectionLink(col1._1, col1._2)
                        </li>
                    }
                </ol>
                <ol>
                    @titleCols.map { case (col1, col2) =>
                        <li>
                            @col2.map { t => @sectionLink(t._1, t._2) }.getOrElse("")
                        </li>
                    }
                </ol>
            </nav>
        </aside>

        @currentSection.map { s =>

            @if(sectionNumber == 1) {

        <div class="panel panel-border-narrow">
            <aside role="complementary" class="notice">
                <div class="column-half">
                    <dl>
                        <dt class="heading-small">Deadline</dt>
                        <dd>Apply any time</dd>
                    </dl>
                </div>

                <div class="column-half">
                    <dl>
                        <dt class="heading-small">Value</dt>
                        <dd>&pound;@opportunity.value.amount @opportunity.value.unit</dd>
                    </dl>
                </div>
            </aside>
        </div>

            }

        <article>
        <h2 class="heading-large">@s.sectionNumber. @s.title</h2>
        @s.paragraphs.map { p =>
        <p class="text">@p</p>
        }
        </article>

        <footer>
            <nav class="govuk-previous-and-next-navigation" role="navigation" aria-label="Pagination">
                <ul class="group">
                        @prevSection.map { s =>
                            <li class="previous-page">
                                <a href="@controllers.routes.OpportunityController.showOpportunity(opportunity.id, Some(s.sectionNumber))"
                                   title="Navigate to the previous page."
                                   rel="previous">
                                    <span class="pagination-part-title">Previous</span>
                                    <span class="pagination-part-label">@s.title</span>
                                </a>
                            </li>
                        }.getOrElse {
                            <li class="previous-page" aria-hidden="true"></li>
                        }

                        @nextSection.map { s =>
                            <li class="next-page">
                                <a href="@controllers.routes.OpportunityController.showOpportunity(opportunity.id, Some(s.sectionNumber))"
                                   title="Navigate to the next page."
                                   rel="next">
                                    <span class="pagination-part-title">Next</span>
                                    <span class="pagination-label">@s.title</span>
                                </a>
                            </li>
                        }.getOrElse {
                            <li class="next-page" aria-hidden="true"></li>
                        }
                </ul>
            </nav>
        </footer>
    </div>


    <div class="column-third">
        <aside role="complementary">
            <hr class="hr-blue">
            <h3 class="heading-medium">Support</h3>
            <ul class="list spacious">

                <li>
                    <a href="@controllers.routes.OpportunityController.showGuidancePage(opportunity.id)" target="_blank">Guidance on
                        seminars</a>
                </li>
                <li>
                    <a href="@controllers.routes.ApplicationController.showOrCreateForForm(applicationId)">Make an
                        application</a>
                </li>

            </ul>
        </aside>
    </div>

</div>
        }

}