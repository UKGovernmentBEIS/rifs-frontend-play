@(
        appForm: ApplicationForm,
        overview: ApplicationOverview,
        opportunity: Opportunity,
        sections: Seq[ApplicationSection],
        title: Option[String],
        answers: Map[Int, Seq[forms.Field]]
)

@import models._
@import partials._


@sectionLink(title: String, sectionNum: Int) = {
    <span class="part-number">@sectionNum. </span>
    <a href="@controllers.routes.ApplicationController.showSectionForm(overview.id, sectionNum)">@title</a>
}

@titleCols() = @{
    val titles = appForm.sections.sortBy(_.sectionNumber).map(s => (s.title, s.sectionNumber))
    val midpoint: Int = Math.round(titles.length / 2.0).toInt
    val (leftCols, b) = titles.splitAt(midpoint)
    val rightCols = b.map(Some(_)) :+ None
    leftCols.zip(rightCols)
}

@formatId(id: Long) = @{
    f"RIFS$id%05d"
}

@main(s"Opportunity ${opportunity.id.id}") {
    <div id="global-header-status" class="contain-floats">
        <div class="float-right">
            <span>Experienced Eric</span>
        </div>
    </div>
    <div class="grid-row">
        <div class="column-two-thirds">

            <div class="breadcrumbs">
                <ol>
                    <li><a href="@controllers.routes.ApplicationController.show(overview.id)">&lt; Return to application overview</a></li>

                </ol>
            </div>

            <h1 class="heading-xlarge">
                <span class="heading-secondary">@formatId(opportunity.id.id): @opportunity.title</span>
                @title
            </h1>

            <aside>
                <nav role="navigation" class="contain-floats page-navigation" aria-label="Navigation">
                    <ol>
                    @titleCols.map { case (col1, col2) =>
                    <li>
                        @sectionLink(col1._1, col1._2)
                    </li>
                    }
                    </ol>
                    <ol>
                    @titleCols.map { case (col1, col2) =>
                    <li>
                        @col2.map { t => @sectionLink(t._1, t._2) }.getOrElse("")
                    </li>
                    }
                    </ol>
                </nav>
            </aside>

            <div class="panel rifs-panel rifs-border-narrow">
                <aside role="complementary" class="notice">
                    <div>
                        <dl>
                            <dt class="heading-small">Review your application before submitting
                                <br/><br/>
                                <a href="@controllers.routes.ApplicationPreviewController.applicationPrintPreview(overview.id)" class="flat" target="_blank">
                                    Print Preview </a>
                            </dt>
                        </dl>
                    </div>
                    <div class="column-full rifs-form-buttons">
                        <p>
                            <a href="@controllers.routes.ApplicationController.show(overview.id)" class="button">
                                Close
                            </a>
                        </p>
                    </div>
                </aside>
            </div>

            <article>
                @for(section <- sections) {
                    @appForm.sections.find(_.sectionNumber == section.sectionNumber).map { appSection =>
                        @appPreview(appSection, answers.getOrElse(section.sectionNumber, Seq()), JsonHelpers.flatten("", section.answers))
                    }
                }

                <p class="rifs-form-buttons">
                    <a href="@controllers.routes.ApplicationController.show(overview.id)" class="button">Close</a>
                </p>
            </article>

        </div>

        <div class="column-third">
        @sidebar(overview, appForm)
        </div>

    </div>

}